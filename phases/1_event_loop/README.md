### 🎯 目的

- Node.jsの「基本構造」（イベントループ、モジュール、非同期処理など）を **内部から理解する**。
- 関数型プログラミングの観点で **副作用や状態管理の扱い方を学ぶ**。
- 学習＋再利用可能な形で **TinyなNode風環境を作る**。

### 🛠 作るもの（例）

- 超簡易Node.jsランタイム（REPL風でもOK）
- 自作イベントループ
- 簡易モジュールローダー
- 最終的には `tiny-node run ./app.tn.js` のようなCLI風の実行も視野に。

---

## 🧪 フェーズ1：超簡易イベントループの実装

### 📚 目的

- Node.jsのイベントループの超基礎構造を模倣
- コールバックを関数キューで管理
- 関数型風に副作用を分離

### 📂 ディレクトリ

```
phases/
  1_event_loop/
    eventLoop.js     // イベントループ本体
    run.js           // 使用例
```

### ▶️ 実行方法

```bash
node phases/1_event_loop/run.js
```

### ✅ 出力例

```
👋 Hello after 1s
✅ Task 2 after 2s
```

---

## 📦 フェーズ2：モジュールローダーの実装（予定）

### 目的

- Node.jsの `require()` を模倣
- ファイル読み込み + キャッシュ + スコープ分離（IIFE）
- 関数で責務を分離・抽象化（読込、パース、キャッシュなど）

---

## 🔄 フェーズ3：非同期処理モデル（miniPromise）

### 目的

- Promiseの構造を内部から理解
- `.then`チェーンや状態遷移（Pending → Fulfilled/Rejected）を模倣

---

## 💻 フェーズ4：REPL風 or CLI風ランタイムの構築

### 目的

- 標準入力からTinyNodeコードを評価し、内部で自作イベントループ・非同期処理を使う
- ちょっとした `.tn.js` ファイルを実行できる仕組みを構築

---

## 🧹 フェーズ5：関数型整理と振り返り

### 目的

- これまでの機能を関数型でどこまで記述できたかを振り返る
- 構造の整合性チェックとリファクタリング

### 拡張候補

- `fs` API の一部模倣（非同期ファイル読み込み）
- `import/export`風のESM構文対応
- クロスプラットフォーム抽象化（パス処理など）

---

## 🧠 関数型プログラミングのガイドライン

TinyNodeでは、**副作用を最小化し、データ変換を純粋関数で記述**するスタイルを重視します。

### 関数型の原則

| ポイント | 説明 |
| --- | --- |
| ✅ 純粋関数 | 同じ入力には同じ出力、内部状態や外部状態に依存しない |
| 🚫 副作用の隔離 | `console.log`, `setTimeout`, `fs`などの副作用は末端だけに |
| 🔁 不変性 | `const` で値を固定。`map` / `reduce` で新しい値を生成 |
| 🔌 合成 | `compose`, `pipe` で関数をつなげる（右→左 / 左→右） |
| 🧩 カリー化 | 使い回しや部分適用がしやすいように小さく分解 |

---

## 🛠 開発ルール

| ルール | 内容 |
| --- | --- |
| 📁 ディレクトリ構成 | `phases/1_event_loop` のように番号付きで分割 |
| 🧪 各フェーズは独立 | 他フェーズに依存せず、それぞれが完結して動作 |
| 🧾 コーディングスタイル | `prettier` または `eslint` で統一（後ほど導入予定） |
| 🗒 TODO管理 | フェーズ内のコメントに `// TODO:` で実装メモを記述 |
| 💬 コミットメッセージ | 以下のフォーマットに従う（後述） |

---

## 📝 コミットメッセージフォーマット

```
<type>(<scope>): <概要>

# 例:
feat(event-loop): setTimeout風イベント追加
refactor(module-loader): キャッシュ機能を関数に分離
docs(readme): フェーズ1の情報を整理
```

| type | 意味 |
| --- | --- |
| feat | 新機能追加 |
| fix | バグ修正 |
| refactor | リファクタリング（挙動変更なし） |
| chore | 雑務・ビルド関連 |
| docs | ドキュメント修正 |
| test | テスト追加・修正 |

---

## 🔖 フェーズ進行チェックリスト

| フェーズ | 内容 | 実装状況 |
| --- | --- | --- |
| 0 | ゴール設定 | ✅ 完了 |
| 1 | 超簡易イベントループ | ✅ 実装済 |
| 2 | モジュールローダー | ⏳ 計画中 |
| 3 | miniPromise | ⏳ 構想中 |
| 4 | REPL/CLI環境 | ⏳ 構想中 |
| 5 | 振り返り・整理 | ⏳ 構想中 |